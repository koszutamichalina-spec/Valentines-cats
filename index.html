<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Walentynkowe Kotki ðŸ’—</title>
  <style>
    :root { --pink: hotpink; }
    body { margin:0; font-family: system-ui, -apple-system, Arial; background:#050505; color:#ffd7ea; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; text-align:center; }
    h1 { margin: 10px 0 6px; font-size: 28px; }
    .sub { opacity:.85; margin: 0 0 10px; }
    .bar { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin: 10px 0 12px; }
    .pill, button {
      border:2px solid var(--pink); border-radius:999px; padding:8px 12px; background:transparent; color:#ffd7ea; font-weight:800;
    }
    button { cursor:pointer; }
    canvas { width:100%; height:auto; border:3px solid var(--pink); border-radius:16px; background:#0a0a0a; touch-action:none; box-shadow:0 0 28px rgba(255,105,180,.35); }

    /* Mobile pads */
    .pads { display:flex; justify-content:space-between; gap:10px; margin-top: 10px; user-select:none; }
    .pad {
      width: 46%;
      border:2px solid rgba(255,105,180,.7);
      border-radius:18px;
      padding:10px;
      background: rgba(0,0,0,.25);
      position: relative;
      min-height: 150px;
      touch-action:none;
    }
    .padTitle { font-weight:900; opacity:.9; margin-bottom:6px; }
    .stickBase {
      width:120px; height:120px; border-radius:999px;
      border:2px solid rgba(255,105,180,.7);
      margin: 10px auto 0;
      position: relative;
      background: rgba(255,105,180,.06);
    }
    .stickKnob {
      width:54px; height:54px; border-radius:999px;
      border:2px solid rgba(255,105,180,.9);
      position: absolute; left:50%; top:50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,.25);
    }
    .hint { font-size: 13px; opacity:.75; margin-top: 10px; }

    /* Overlays */
    .overlay {
      position: fixed; inset: 0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.86);
      padding: 18px;
      z-index: 9999;
    }
    .card {
      width: min(560px, 92vw);
      background: #070707;
      border: 3px solid var(--pink);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      text-align:left;
    }
    .card h2 { margin: 0 0 8px; }
    .card p { margin: 0 0 10px; opacity:.9; }
    .row { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; margin-top: 10px; }
    input {
      width:100%;
      box-sizing:border-box;
      padding: 12px 14px;
      border-radius: 12px;
      border: 2px solid rgba(255,105,180,.7);
      outline: none;
      background: #0d0d0d;
      color: #ffd7ea;
      font-weight: 700;
      margin: 6px 0 10px;
    }
    .imgWin {
      width:100%;
      border-radius:14px;
      border:2px solid rgba(255,105,180,.75);
      box-shadow: 0 0 26px rgba(255,105,180,.25);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Walentynkowe Kotki ðŸ’—</h1>
    <p class="sub">Telefon: joysticki na dole â€¢ Komp: strzaÅ‚ki + WASD</p>

    <div class="bar">
      <div class="pill">Level: <span id="lvl">1</span>/3</div>
      <div class="pill">Serduszka: <span id="gems">0</span>/<span id="gemsTotal">0</span></div>
      <button id="restartBtn">Restart</button>
    </div>

    <canvas id="cv" width="900" height="520"></canvas>

    <div class="pads">
      <div class="pad" id="pad1">
        <div class="padTitle">Kotek 1</div>
        <div class="stickBase"><div class="stickKnob" id="knob1"></div></div>
      </div>
      <div class="pad" id="pad2">
        <div class="padTitle">Kotek 2</div>
        <div class="stickBase"><div class="stickKnob" id="knob2"></div></div>
      </div>
    </div>

    <div class="hint">Tip: jak kotki sÄ… blisko â†’ pojawia siÄ™ maÅ‚e ðŸ’—. Drzwi z sercem otwierajÄ… siÄ™, gdy OBA kotki wejdÄ… do Å›rodka.</div>
  </div>

  <!-- QUIZ overlay -->
  <div class="overlay" id="quizOverlay">
    <div class="card">
      <h2>Mini quiz ðŸ’Œ</h2>
      <p>Odpowiedz na 2 pytania, a potem dostaniesz nagrodÄ™ ðŸ˜¼ðŸ’—</p>

      <label><b>Pytanie 1:</b> Jakie hasÅ‚o masz na kartce? (wpisz dokÅ‚adnie)</label>
      <input id="q1" placeholder="np. SERDUSZKO" />

      <label><b>Pytanie 2:</b> Ile byÅ‚o leveli w grze?</label>
      <input id="q2" placeholder="np. 3" />

      <div id="quizMsg" style="min-height:18px; opacity:.9;"></div>

      <div class="row">
        <button id="quizCheck">SprawdÅº ðŸ’–</button>
      </div>
    </div>
  </div>

  <!-- WIN overlay -->
  <div class="overlay" id="winOverlay">
    <div class="card">
      <h2>WygraÅ‚eÅ› ðŸ’—</h2>
      <p>To Twoja nagrodaâ€¦</p>
      <img class="imgWin" src="IMG_2704.jpeg" alt="nasze zdjÄ™cie" />
      <p style="margin-top:10px; font-weight:800;">Kocham CiÄ™. â€” Misia ðŸ’˜</p>

      <audio id="winMusic" src="win.mp3" preload="auto"></audio>

      <div class="row">
        <button id="playMusic">OdtwÃ³rz muzykÄ™ ðŸŽ¶</button>
        <button id="closeWin">Zamknij</button>
      </div>
      <p style="font-size:12px; opacity:.7; margin-top:8px;">Na iPhonie muzyka startuje po klikniÄ™ciu (taki urok telefonu).</p>
    </div>
  </div>

<script>
(() => {
  const cv = document.getElementById("cv");
  const ctx = cv.getContext("2d");

  const lvlEl = document.getElementById("lvl");
  const gemsEl = document.getElementById("gems");
  const gemsTotalEl = document.getElementById("gemsTotal");
  const restartBtn = document.getElementById("restartBtn");

  const quizOverlay = document.getElementById("quizOverlay");
  const winOverlay = document.getElementById("winOverlay");
  const quizCheck = document.getElementById("quizCheck");
  const quizMsg = document.getElementById("quizMsg");
  const q1 = document.getElementById("q1");
  const q2 = document.getElementById("q2");
  const winMusic = document.getElementById("winMusic");
  const playMusic = document.getElementById("playMusic");
  const closeWin = document.getElementById("closeWin");

  // USTAW to hasÅ‚o na takie, jakie napiszesz mu na kartce:
  const SECRET_WORD = "SERDUSZKO";

  // ---------- Simple level data ----------
  // walls: rectangles; spikes: rectangles (hurt); gems: circles; door: rect
  // (TU SÄ„ JUÅ» TYLKO 3 LEVELE)
  const levels = [
    {
      bg: { r: 10, g: 0, b: 18 }, // dark
      walls: [
        {x: 0, y: 0, w: 900, h: 24},
        {x: 0, y: 496, w: 900, h: 24},
        {x: 0, y: 0, w: 24, h: 520},
        {x: 876, y: 0, w: 24, h: 520},

        {x: 160, y: 90, w: 18, h: 340},
        {x: 320, y: 24, w: 18, h: 300},
        {x: 480, y: 170, w: 18, h: 326},
        {x: 640, y: 24, w: 18, h: 280},
      ],
      spikes: [
        {x: 240, y: 496-24, w: 120, h: 24},
        {x: 520, y: 496-24, w: 120, h: 24},
      ],
      gems: [
        {x: 110, y: 60}, {x: 410, y: 120}, {x: 710, y: 90}
      ],
      door: {x: 820, y: 220, w: 56, h: 90}
    },
    {
      bg: { r: 35, g: 0, b: 45 },
      walls: [
        {x: 0, y: 0, w: 900, h: 24},
        {x: 0, y: 496, w: 900, h: 24},
        {x: 0, y: 0, w: 24, h: 520},
        {x: 876, y: 0, w: 24, h: 520},

        {x: 120, y: 120, w: 660, h: 18},
        {x: 120, y: 380, w: 660, h: 18},
        {x: 120, y: 138, w: 18, h: 242},
        {x: 762, y: 138, w: 18, h: 242},

        {x: 420, y: 138, w: 18, h: 150},
        {x: 240, y: 250, w: 360, h: 18},
      ],
      spikes: [
        {x: 120, y: 250+18, w: 120, h: 18},
        {x: 600, y: 250+18, w: 180, h: 18},
      ],
      gems: [
        {x: 160, y: 80}, {x: 740, y: 80}, {x: 450, y: 460}
      ],
      door: {x: 38, y: 215, w: 56, h: 90}
    },
    {
      bg: { r: 60, g: 0, b: 75 },
      walls: [
        {x: 0, y: 0, w: 900, h: 24},
        {x: 0, y: 496, w: 900, h: 24},
        {x: 0, y: 0, w: 24, h: 520},
        {x: 876, y: 0, w: 24, h: 520},

        {x: 140, y: 70, w: 620, h: 18},
        {x: 140, y: 420, w: 620, h: 18},
        {x: 140, y: 88, w: 18, h: 332},
        {x: 742, y: 88, w: 18, h: 332},

        {x: 260, y: 180, w: 18, h: 240},
        {x: 380, y: 88, w: 18, h: 240},
        {x: 500, y: 180, w: 18, h: 240},
        {x: 620, y: 88, w: 18, h: 240},
      ],
      spikes: [
        {x: 158, y: 88, w: 102, h: 18},
        {x: 398, y: 496-42, w: 120, h: 18},
      ],
      gems: [
        {x: 200, y: 460}, {x: 700, y: 460}, {x: 450, y: 50}
      ],
      door: {x: 820, y: 220, w: 56, h: 90}
    }
  ];

  // ---------- Controls (keyboard + joysticks) ----------
  const key = {};
  window.addEventListener("keydown", e => key[e.key.toLowerCase()] = true);
  window.addEventListener("keyup", e => key[e.key.toLowerCase()] = false);

  const pad1 = document.getElementById("pad1");
  const pad2 = document.getElementById("pad2");
  const knob1 = document.getElementById("knob1");
  const knob2 = document.getElementById("knob2");

  function makeStick(pad, knob){
    const st = { active:false, id:null, dx:0, dy:0, cx:0, cy:0 };
    const base = pad.querySelector(".stickBase");
    function setKnob(dx,dy){
      const r = 42;
      const len = Math.hypot(dx,dy);
      const k = len > r ? r/len : 1;
      const x = dx*k, y = dy*k;
      knob.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      st.dx = x/r; st.dy = y/r;
    }
    function reset(){
      st.active=false; st.id=null; st.dx=0; st.dy=0;
      knob.style.transform = "translate(-50%,-50%)";
    }
    base.addEventListener("pointerdown", (e) => {
      base.setPointerCapture(e.pointerId);
      st.active=true; st.id=e.pointerId;
      const rect = base.getBoundingClientRect();
      st.cx = rect.left + rect.width/2;
      st.cy = rect.top + rect.height/2;
      setKnob(e.clientX - st.cx, e.clientY - st.cy);
    });
    base.addEventListener("pointermove", (e) => {
      if(!st.active || e.pointerId !== st.id) return;
      setKnob(e.clientX - st.cx, e.clientY - st.cy);
    });
    base.addEventListener("pointerup", (e) => { if(e.pointerId===st.id) reset(); });
    base.addEventListener("pointercancel", (e) => { if(e.pointerId===st.id) reset(); });
    return st;
  }

  const stick1 = makeStick(pad1, knob1);
  const stick2 = makeStick(pad2, knob2);

  // ---------- Game state ----------
  let L = 0;
  let gemsCollected = 0;

  const catA = { x: 90, y: 420, r: 14 };
  const catB = { x: 140, y: 420, r: 14 };

  function resetLevel(){
    const door = levels[L].door;
    if (door.x > cv.width/2){
      catA.x = 70; catB.x = 120;
      catA.y = cv.height - 70; catB.y = cv.height - 70;
    } else {
      catA.x = cv.width - 70; catB.x = cv.width - 120;
      catA.y = cv.height - 70; catB.y = cv.height - 70;
    }
  }

  function currentGems(){
    return levels[L].gems.map(g => ({...g, taken:false}));
  }
  let gems = currentGems();

  function setUI(){
    lvlEl.textContent = String(L+1);
    gemsCollected = 0;
    gemsEl.textContent = "0";
    gemsTotalEl.textContent = String(gems.length);
  }

  function startLevel(n){
    L = n;
    gems = currentGems();
    setUI();
    resetLevel();
  }

  startLevel(0);

  // ---------- Collision helpers ----------
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function circleRectCollide(cx,cy,r, rect){
    const x = clamp(cx, rect.x, rect.x+rect.w);
    const y = clamp(cy, rect.y, rect.y+rect.h);
    return (cx-x)**2 + (cy-y)**2 <= r**2;
  }

  function moveWithCollisions(cat, vx, vy){
    cat.x += vx;
    for(const w of levels[L].walls){
      if(circleRectCollide(cat.x,cat.y,cat.r,w)){
        cat.x -= vx;
        break;
      }
    }
    cat.y += vy;
    for(const w of levels[L].walls){
      if(circleRectCollide(cat.x,cat.y,cat.r,w)){
        cat.y -= vy;
        break;
      }
    }
    cat.x = clamp(cat.x, cat.r, cv.width - cat.r);
    cat.y = clamp(cat.y, cat.r, cv.height - cat.r);
  }

  function hitSpikes(cat){
    for(const s of levels[L].spikes){
      if(circleRectCollide(cat.x,cat.y,cat.r,s)) return true;
    }
    return false;
  }

  function inDoor(cat){
    const d = levels[L].door;
    return circleRectCollide(cat.x,cat.y,cat.r, d);
  }

  function nearTogether(){
    return Math.hypot(catA.x-catB.x, catA.y-catB.y) < 48;
  }

  // ---------- Draw ----------
  function bgFill(){
    const b = levels[L].bg;
    const grad = ctx.createLinearGradient(0,0,0,cv.height);
    grad.addColorStop(0, `rgb(${b.r},${b.g},${b.b})`);
    grad.addColorStop(1, `rgb(${Math.max(0,b.r-10)},${b.g},${Math.max(0,b.b-20)})`);
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,cv.width,cv.height);

    ctx.save();
    ctx.globalAlpha = 0.12;
    ctx.fillStyle = "#fff";
    for(let i=0;i<38;i++){
      const x = (i*97 + (L+1)*53) % cv.width;
      const y = (i*71 + (L+1)*29) % cv.height;
      ctx.fillRect(x,y,2,2);
    }
    ctx.restore();
  }

  function drawWalls(){
    ctx.save();
    ctx.fillStyle = "rgba(255,105,180,.22)";
    for(const w of levels[L].walls) ctx.fillRect(w.x,w.y,w.w,w.h);

    ctx.strokeStyle = "rgba(255,105,180,.7)";
    ctx.lineWidth = 2;
    for(const w of levels[L].walls) ctx.strokeRect(w.x,w.y,w.w,w.h);
    ctx.restore();
  }

  function drawSpikes(){
    ctx.save();
    ctx.fillStyle = "rgba(255,105,180,.22)";
    ctx.strokeStyle = "rgba(255,105,180,.8)";
    ctx.lineWidth = 2;
    for(const s of levels[L].spikes){
      ctx.strokeRect(s.x,s.y,s.w,s.h);
      const n = Math.max(3, Math.floor(s.w/18));
      for(let i=0;i<n;i++){
        const x0 = s.x + i*(s.w/n);
        const x1 = s.x + (i+1)*(s.w/n);
        const xm = (x0+x1)/2;
        ctx.beginPath();
        ctx.moveTo(x0, s.y+s.h);
        ctx.lineTo(xm, s.y);
        ctx.lineTo(x1, s.y+s.h);
        ctx.closePath();
        ctx.stroke();
      }
    }
    ctx.restore();
  }

  function drawDoor(){
    const d = levels[L].door;
    ctx.save();
    ctx.strokeStyle = "rgba(255,105,180,.95)";
    ctx.lineWidth = 3;
    ctx.strokeRect(d.x,d.y,d.w,d.h);

    const x = d.x + d.w/2;
    const y = d.y + d.h/2 + 6;
    const s = 16;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.bezierCurveTo(x - s, y - s, x - 2*s, y + s/2, x, y + 2*s);
    ctx.bezierCurveTo(x + 2*s, y + s/2, x + s, y - s, x, y);
    ctx.closePath();
    ctx.stroke();
    ctx.restore();
  }

  function drawGems(){
    ctx.save();
    ctx.strokeStyle = "rgba(255,105,180,.95)";
    ctx.lineWidth = 2.5;
    for(const g of gems){
      if(g.taken) continue;
      const x=g.x, y=g.y, s=10;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.bezierCurveTo(x - s, y - s, x - 2*s, y + s/2, x, y + 2*s);
      ctx.bezierCurveTo(x + 2*s, y + s/2, x + s, y - s, x, y);
      ctx.closePath();
      ctx.stroke();
    }
    ctx.restore();
  }

  function drawCats(){
    function catFace(cat, tint){
      ctx.save();
      ctx.lineWidth = 2.5;
      ctx.strokeStyle = "rgba(255,105,180,.9)";
      ctx.fillStyle = tint;

      ctx.beginPath();
      ctx.arc(cat.x,cat.y,cat.r,0,Math.PI*2);
      ctx.fill();
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(cat.x - cat.r*0.6, cat.y - cat.r*0.6);
      ctx.lineTo(cat.x - cat.r*0.2, cat.y - cat.r*1.35);
      ctx.lineTo(cat.x, cat.y - cat.r*0.7);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(cat.x + cat.r*0.6, cat.y - cat.r*0.6);
      ctx.lineTo(cat.x + cat.r*0.2, cat.y - cat.r*1.35);
      ctx.lineTo(cat.x, cat.y - cat.r*0.7);
      ctx.stroke();

      ctx.beginPath(); ctx.arc(cat.x - cat.r*0.25, cat.y - cat.r*0.05, 2.2, 0, Math.PI*2); ctx.stroke();
      ctx.beginPath(); ctx.arc(cat.x + cat.r*0.25, cat.y - cat.r*0.05, 2.2, 0, Math.PI*2); ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(cat.x, cat.y + 2);
      ctx.lineTo(cat.x, cat.y + 8);
      ctx.moveTo(cat.x, cat.y + 8);
      ctx.lineTo(cat.x - 7, cat.y + 13);
      ctx.moveTo(cat.x, cat.y + 8);
      ctx.lineTo(cat.x + 7, cat.y + 13);
      ctx.stroke();

      ctx.restore();
    }
    catFace(catA, "rgba(255, 240, 248, .85)");
    catFace(catB, "rgba(255, 210, 232, .65)");
  }

  function drawTogetherHeart(){
    const x = (catA.x + catB.x)/2;
    const y = (catA.y + catB.y)/2 - 28;
    ctx.save();
    ctx.strokeStyle = "rgba(255,105,180,.95)";
    ctx.lineWidth = 3;
    const s = 12;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.bezierCurveTo(x - s, y - s, x - 2*s, y + s/2, x, y + 2*s);
    ctx.bezierCurveTo(x + 2*s, y + s/2, x + s, y - s, x, y);
    ctx.closePath();
    ctx.stroke();
    ctx.restore();
  }

  // ---------- Game loop ----------
  let running = true;

  function step(){
    if(!running) return;

    const spd = 3.0;

    let ax = 0, ay = 0;
    if(key["arrowleft"]) ax -= 1;
    if(key["arrowright"]) ax += 1;
    if(key["arrowup"]) ay -= 1;
    if(key["arrowdown"]) ay += 1;
    ax += stick1.dx;
    ay += stick1.dy;

    let bx = 0, by = 0;
    if(key["a"]) bx -= 1;
    if(key["d"]) bx += 1;
    if(key["w"]) by -= 1;
    if(key["s"]) by += 1;
    bx += stick2.dx;
    by += stick2.dy;

    const al = Math.hypot(ax,ay) || 1;
    const bl = Math.hypot(bx,by) || 1;

    moveWithCollisions(catA, (ax/al)*spd, (ay/al)*spd);
    moveWithCollisions(catB, (bx/bl)*spd, (by/bl)*spd);

    if(hitSpikes(catA) || hitSpikes(catB)){
      resetLevel();
      gems = currentGems();
      setUI();
    }

    for(const g of gems){
      if(g.taken) continue;
      if(Math.hypot(catA.x-g.x, catA.y-g.y) < catA.r + 12 ||
         Math.hypot(catB.x-g.x, catB.y-g.y) < catB.r + 12){
        g.taken = true;
        gemsCollected += 1;
        gemsEl.textContent = String(gemsCollected);
      }
    }

    const allTaken = gemsCollected >= gems.length;
    if(allTaken && inDoor(catA) && inDoor(catB)){
      if(L < 2){
        startLevel(L+1);
      } else {
        running = false;
        quizOverlay.style.display = "grid";
      }
    }

    bgFill();
    drawWalls();
    drawSpikes();
    drawGems();
    drawDoor();
    drawCats();
    if(nearTogether()) drawTogetherHeart();

    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,.75)";
    ctx.font = "700 14px system-ui";
    if(gemsCollected < gems.length){
      ctx.fillText("Zbierz wszystkie serduszka, potem wejdÅºcie OBA do drzwi ðŸ’—", 24, 44);
    } else {
      ctx.fillText("Macie komplet! WejdÅºcie OBA do drzwi ðŸ’—", 24, 44);
    }
    ctx.restore();

    requestAnimationFrame(step);
  }

  requestAnimationFrame(step);

  restartBtn.addEventListener("click", () => startLevel(0));

  function norm(s){ return (s||"").trim().toUpperCase(); }

  quizCheck.addEventListener("click", () => {
    const a1 = norm(q1.value);
    const a2 = norm(q2.value);

    if(a1 === norm(SECRET_WORD) && a2 === "3"){
      quizOverlay.style.display = "none";
      winOverlay.style.display = "grid";
      quizMsg.textContent = "";
    } else {
      quizMsg.textContent = "Niee ðŸ˜¼ sprÃ³buj jeszcze (hasÅ‚o z kartki + liczba leveli).";
    }
  });

  playMusic.addEventListener("click", async () => {
    try { await winMusic.play(); } catch(e) {}
  });

  closeWin.addEventListener("click", () => {
    winOverlay.style.display = "none";
    try { winMusic.pause(); winMusic.currentTime = 0; } catch(e) {}
    running = true;
    startLevel(0);
    requestAnimationFrame(step);
  });
})();
</script>
</body>
</html>
